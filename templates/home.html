{% extends 'base.html' %}
{% load static %}
{% block content %}
<section class="hero">
  <h1>.MP4</h1>
  <p>¡Cantado por ellos, contado por nosotros!</p>
<section class="posts">
  {% if posts %}
    <ul style="list-style:none; padding-left:0; margin:0; display:grid; gap:16px;">
      {% for p in posts %}
        <li class="card" style="display:grid; grid-template-columns: minmax(240px, 520px) 1fr; gap:12px; align-items:start;">
          {% if p.image %}
            {% if user.is_authenticated %}
              <a href="{% url 'pages:page_detail' p.pk %}">
                <img src="{{ p.image.url }}" alt="{{ p.title }}" style="width:100%; height:360px; object-fit:contain; background:#111; border-radius:12px; display:block;">
              </a>
            {% else %}
              <img src="{{ p.image.url }}" alt="{{ p.title }}" style="width:100%; height:360px; object-fit:contain; background:#111; border-radius:12px; display:block;">
            {% endif %}
          {% else %}
            <div style="width:100%; height:360px; background:#222; border-radius:12px; display:flex; align-items:center; justify-content:center;">
              <span style="font-size:12px; opacity:.7;">.MP4</span>
            </div>
          {% endif %}
          <div>
            <h3 style="margin:0 0 4px 0;">
              {% if user.is_authenticated %}
                <a href="{% url 'pages:page_detail' p.pk %}">{{ p.title }}</a>
              {% else %}
                {{ p.title }}
              {% endif %}
            </h3>
            {% if p.subtitle %}<p class="muted" style="margin:0 0 6px 0;">{{ p.subtitle }}</p>{% endif %}
            <p class="meta" style="margin:0 0 6px 0; font-size:12px; opacity:.8;">
              {{ p.published_at }}{% if p.author %} — por {{ p.author.username }}{% endif %}
            </p>
            <p style="margin:0;">{{ p.content|striptags|truncatewords:30 }}</p>

            <div style="margin-top:8px;">
              {% if user.is_authenticated %}
                <a class="btn" href="{% url 'pages:page_detail' p.pk %}">Leer más</a>
              {% else %}
                <span class="btn" style="pointer-events:none; opacity:.6;">Iniciá sesión para leer</span>
              {% endif %}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="muted">Todavía no hay publicaciones.</p>
  {% endif %}
</section>
{% endblock %}
